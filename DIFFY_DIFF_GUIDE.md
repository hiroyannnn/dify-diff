# Dify DSL ã®å·®åˆ†ç®¡ç†ã‚’å¾¹åº•èª¿æŸ»ï¼ã€Œæ„å‘³ã®ã‚ã‚‹å¤‰æ›´ã€ã ã‘ã‚’è¦‹ã¤ã‘ã‚‹4ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ä½œæˆæ—¥**: 2025-12-08
**æ›´æ–°æ—¥**: 2025-12-10
**å¯¾è±¡**: Dify ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ Git ç®¡ç†ã—ã¦ã„ã‚‹é–‹ç™ºè€…ãƒ»ãƒãƒ¼ãƒ 

---

## ç›®æ¬¡

1. [ã¯ã˜ã‚ã«ï¼šå·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ‚©ã¿](#ã¯ã˜ã‚ã«å·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ‚©ã¿)
2. [å‰æçŸ¥è­˜ï¼šDify DSL ã®æ§‹é€ ](#å‰æçŸ¥è­˜dify-dsl-ã®æ§‹é€ )
3. [èª¿æŸ»ã®èƒŒæ™¯](#èª¿æŸ»ã®èƒŒæ™¯)
4. [å®Ÿéš›ã®å·®åˆ†ã‚’è¦‹ã¦ã¿ã‚‹](#å®Ÿéš›ã®å·®åˆ†ã‚’è¦‹ã¦ã¿ã‚‹)
5. [4ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¾¹åº•æ¯”è¼ƒ](#4ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¾¹åº•æ¯”è¼ƒ)
6. [ã¾ã¨ã‚](#ã¾ã¨ã‚)

---

## ã¯ã˜ã‚ã«ï¼šå·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ‚©ã¿

Dify ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é–‹ç™ºã—ã¦ã„ã‚‹ã¨ã€ã“ã‚“ãªçµŒé¨“ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

> ã€ŒDSL ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`chat.yml`ï¼‰ã‚’ export ã—ã¦ Git ã§ç®¡ç†ã—ã¦ã„ã‚‹ã‘ã©ã€diff ãŒ**ã‚ã¡ã‚ƒãã¡ã‚ƒè¦‹ã¥ã‚‰ã„**...ã€

```diff
- position: {x: 379, y: 282}
+ position: {x: 291, y: 128}
- width: 244
+ width: 242
- selected: true
+ selected: false
```

ã“ã†ã„ã£ãŸ**è¦‹æ „ãˆã®å¤‰æ›´**ã°ã‹ã‚Šã§ã€è‚å¿ƒã®**ã€Œä½•ãŒå‡¦ç†ã¨ã—ã¦å¤‰ã‚ã£ãŸã®ã‹ï¼Ÿã€**ãŒåŸ‹ã‚‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«å®Ÿæ–½ã—ãŸèª¿æŸ»çµæœã¨ã€**4ã¤ã®å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã‚’æ¯”è¼ƒæ¤œè¨ã—ãŸå†…å®¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

## ğŸ“š å‰æçŸ¥è­˜ï¼šDify DSL ã®æ§‹é€ 

### Dify DSL ã¨ã¯ï¼Ÿ

å…¬å¼ã®è©³ç´°ä»•æ§˜ãƒšãƒ¼ã‚¸ã¯ï¼ˆæœ¬èª¿æŸ»æ™‚ç‚¹ã§ã¯ï¼‰è¦‹å½“ãŸã‚Šã¾ã›ã‚“ã€‚ã“ã“ã§ã¯ **Dify ã® export ã§å¾—ã‚‰ã‚Œã‚‹ YAML å®Ÿä½“**ã¨ã€å…¬é–‹ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹æ§‹é€ ã‚’ãƒ™ãƒ¼ã‚¹ã«èª¬æ˜ã—ã¾ã™ã€‚YAML å½¢å¼ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã©ã‚’è¨˜è¿°ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

> ğŸ“– ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ #8090 ã§ã‚‚ã€ŒDSL ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ãƒ‡ãƒ¼ã‚¿(JSON)ã‚’ãã®ã¾ã¾ä½¿ã£ã¦ãŠã‚Šã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§Python dictã«å¤‰æ›å¾ŒYAMLã¸ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã ã‘ã€ã¨ã„ã†èª¬æ˜ãŒã‚ã‚Šã€æ­£å¼ãªæ–‡æ³•æ›¸ã¯æç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å¸¸ã«æœ€æ–°ã® export çµæœã‚’å„ªå…ˆã—ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚ (https://github.com/langgenius/dify/discussions/8090)

### ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«æ§‹é€ 

Dify DSL ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®4ã¤ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š

```yaml
app:                  # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  description: "..."  # èª¬æ˜æ–‡
  icon: ğŸ¤–           # ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆçµµæ–‡å­—ï¼‰
  icon_background: '#FFEAD5'
  mode: advanced-chat # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰
  name: "My App"
  use_icon_as_answer_icon: true

dependencies:         # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ»æ‹¡å¼µæ©Ÿèƒ½ã®ä¾å­˜é–¢ä¿‚
  - type: marketplace
    value:
      marketplace_plugin_unique_identifier: "..."

kind: app            # ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ï¼ˆå›ºå®šå€¤ï¼‰

version: 0.4.0       # DSL ãƒãƒ¼ã‚¸ãƒ§ãƒ³

workflow:            # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ï¼ˆè©³ç´°ã¯å¾Œè¿°ï¼‰
  conversation_variables: [...]
  environment_variables: [...]
  features: {...}
  graph: {...}
```

### workflow é…ä¸‹ã®æ§‹é€ 

`workflow` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œã‚’å®šç¾©ã™ã‚‹æœ€ã‚‚é‡è¦ãªéƒ¨åˆ†ã§ã™ï¼š

```yaml
workflow:
  # ä¼šè©±ä¸­ã«ä¿æŒã•ã‚Œã‚‹å¤‰æ•°ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ•°ï¼‰
  conversation_variables:
    - id: "uuid"
      name: "variable_name"
      description: "èª¬æ˜"
      value_type: string|array[string]|number|array[number]
      value: "default value"
      selector: [conversation, variable_name]

  # ç’°å¢ƒå¤‰æ•°ï¼ˆAPI ã‚­ãƒ¼ãªã©ï¼‰
  environment_variables:
    - id: "uuid"
      name: "api_key"
      value_type: string
      value: "***"
      selector: [env, api_key]

  # æ©Ÿèƒ½è¨­å®š
  features:
    file_upload:
      enabled: true
      allowed_file_types: [document, image]
    retriever_resource:
      enabled: true
    speech_to_text:
      enabled: false
    text_to_speech:
      enabled: false
    opening_statement: "Welcome message"

  # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚°ãƒ©ãƒ•æ§‹é€ 
  graph:
    nodes: [...]      # ãƒãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆ
    edges: [...]      # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šï¼‰ã®ãƒªã‚¹ãƒˆ
    viewport:         # âš ï¸ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
      x: 0
      y: 0
      zoom: 1
```

### graph.nodes ã®æ§‹é€ 

ãƒãƒ¼ãƒ‰ã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å‡¦ç†å˜ä½ã§ã™ã€‚å„ãƒãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã®æ§‹é€ ãŒã‚ã‚Šã¾ã™ï¼š

```yaml
nodes:
  - id: "1234567890"           # ãƒãƒ¼ãƒ‰ IDï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰

    # âš ï¸ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæƒ…å ±ï¼‰
    position:
      x: 100
      y: 200
    positionAbsolute:
      x: 100
      y: 200
    width: 244
    height: 90
    selected: false
    sourcePosition: right
    targetPosition: left
    type: custom

    # âœ… å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆé‡è¦ï¼ï¼‰
    data:
      type: llm|start|answer|tool|if-else|code|...
      title: "ãƒãƒ¼ãƒ‰å"

      # LLM ãƒãƒ¼ãƒ‰ã®å ´åˆ
      model:
        mode: chat
        name: "gpt-4"
        provider: "openai"
        completion_params:
          temperature: 0.7

      prompt_template:
        - id: "uuid"
          role: system|user|assistant
          text: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡"

      # ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãƒ‰ã®å ´åˆ
      tool_name: "tool_id"
      tool_parameters:
        param1:
          type: variable|constant
          value: "..."

      # ãã®ä»–ã®ãƒãƒ¼ãƒ‰å›ºæœ‰ãƒ‡ãƒ¼ã‚¿
```

#### ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ä¸€è¦§

å®Ÿéš›ã® DSL ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ¤œå‡ºã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼š

| ã‚¿ã‚¤ãƒ— | èª¬æ˜ | ç”¨é€” |
|--------|------|------|
| `start` | é–‹å§‹ãƒãƒ¼ãƒ‰ | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ |
| `llm` | LLM ãƒãƒ¼ãƒ‰ | AI ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ãŸç”Ÿæˆãƒ»æ¨è«– |
| `answer` | å›ç­”ãƒãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è¿”ç­” |
| `tool` | ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãƒ‰ | å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ãƒ»API ã®å‘¼ã³å‡ºã— |
| `if-else` | æ¡ä»¶åˆ†å²ãƒãƒ¼ãƒ‰ | ãƒ•ãƒ­ãƒ¼ã®åˆ†å² |
| `code` | ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œãƒãƒ¼ãƒ‰ | Python/JavaScript ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œ |
| `document-extractor` | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŠ½å‡ºãƒãƒ¼ãƒ‰ | PDF ãªã©ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º |
| `assigner` | å¤‰æ•°ä»£å…¥ãƒãƒ¼ãƒ‰ | å¤‰æ•°ã¸ã®å€¤ã®ä»£å…¥ |

### graph.edges ã®æ§‹é€ 

ã‚¨ãƒƒã‚¸ã¯ãƒãƒ¼ãƒ‰é–“ã®æ¥ç¶šã‚’å®šç¾©ã—ã¾ã™ï¼š

```yaml
edges:
  - id: "edge_id"              # ã‚¨ãƒƒã‚¸ ID
    source: "source_node_id"   # æ¥ç¶šå…ƒãƒãƒ¼ãƒ‰ ID
    target: "target_node_id"   # æ¥ç¶šå…ˆãƒãƒ¼ãƒ‰ ID
    sourceHandle: source       # æ¥ç¶šå…ƒã®ãƒãƒ³ãƒ‰ãƒ«
    targetHandle: target       # æ¥ç¶šå…ˆã®ãƒãƒ³ãƒ‰ãƒ«
    type: custom

    # âš ï¸ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    selected: false
    zIndex: 0

    # ã‚¨ãƒƒã‚¸ã®ãƒ¡ã‚¿æƒ…å ±
    data:
      sourceType: llm
      targetType: answer
      isInLoop: false
```

### UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ vs å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯

Dify DSL ã«ã¯ã€**UI è¡¨ç¤ºã®ã¿ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ã¨ã€**å®Ÿéš›ã®å‡¦ç†ã«å½±éŸ¿ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ãŒæ··åœ¨ã—ã¦ã„ã¾ã™ï¼š

#### âš ï¸ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç„¡è¦–ã™ã¹ãï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å ´æ‰€ | èª¬æ˜ |
|-----------|------|------|
| `position.x/y` | nodes | canvas ä¸Šã®ãƒãƒ¼ãƒ‰åº§æ¨™ |
| `positionAbsolute.x/y` | nodes | çµ¶å¯¾åº§æ¨™ |
| `width` / `height` | nodes | ãƒãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚º |
| `selected` | nodes / edges | é¸æŠçŠ¶æ…‹ |
| `zIndex` | edges | è¡¨ç¤ºé †åº |
| `viewport.x/y/zoom` | graph | canvas ã®è¡¨ç¤ºä½ç½®ãƒ»ã‚ºãƒ¼ãƒ  |
| `sourcePosition` / `targetPosition` | nodes | ã‚¨ãƒƒã‚¸ã®æ¥ç¶šä½ç½® |
| `type: custom` | nodes / edges | UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¿ã‚¤ãƒ— |

#### âœ… å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ¤œçŸ¥ã™ã¹ãï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å ´æ‰€ | èª¬æ˜ |
|-----------|------|------|
| `app.description` | app | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èª¬æ˜ |
| `app.mode` | app | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ |
| `version` | ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« | DSL ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| `dependencies[]` | ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¾å­˜ |
| `conversation_variables` | workflow | ã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ•° |
| `environment_variables` | workflow | ç’°å¢ƒå¤‰æ•° |
| `features` | workflow | æ©Ÿèƒ½è¨­å®š |
| `nodes[].data.type` | graph.nodes | ãƒãƒ¼ãƒ‰ã®ç¨®é¡ |
| `nodes[].data.model` | graph.nodes (llm) | AI ãƒ¢ãƒ‡ãƒ«è¨­å®š |
| `nodes[].data.prompt_template` | graph.nodes (llm) | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ |
| `nodes[].data.completion_params` | graph.nodes (llm) | ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
| `nodes[].data.tool_*` | graph.nodes (tool) | ãƒ„ãƒ¼ãƒ«è¨­å®š |
| `edges[].source/target` | graph.edges | ãƒãƒ¼ãƒ‰æ¥ç¶š |

### DSL ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨é€²åŒ–

Dify DSL ã¯æ´»ç™ºã«é€²åŒ–ã—ã¦ãŠã‚Šã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ§‹é€ ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š

- **v0.3.0 â†’ v0.4.0** ã®å¤‰æ›´ä¾‹ï¼ˆå®Ÿæ¸¬ï¼‰:
  - ãƒ„ãƒ¼ãƒ«è¨­å®šãŒæ–‡å­—åˆ—ã‹ã‚‰æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›´
    ```yaml
    # v0.3.0
    tool_configurations:
      format: markdown

    # v0.4.0
    tool_configurations:
      format:
        type: constant
        value: markdown
    ```
  - `tool_node_version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ 
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ `version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ï¼ˆç©ºå€¤ï¼‰

> ğŸ’¡ **é‡è¦**: DSL ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ Dify ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ­£è¦åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®šæœŸçš„ã«è¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚

### å‚è€ƒãƒªãƒ³ã‚¯

- [Dify ã‚¢ãƒ—ãƒªç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.dify.ai/en/guides/management/app-management)
- [Dify DSL æ–‡æ³•ã«é–¢ã™ã‚‹ Discussion](https://github.com/langgenius/dify/discussions/8090)
- [Dify Workflow ãƒãƒ¼ãƒ‰ API å®Ÿè£…](https://github.com/langgenius/dify/blob/main/api/core/workflow/nodes/base/node.py)

---

## ğŸ” èª¿æŸ»ã®èƒŒæ™¯

### è§£æ±ºã—ãŸã„èª²é¡Œ

1. **UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ã‚º**: ãƒãƒ¼ãƒ‰åº§æ¨™ï¼ˆ`position`ï¼‰ã€ã‚µã‚¤ã‚ºï¼ˆ`width`/`height`ï¼‰ã€é¸æŠçŠ¶æ…‹ï¼ˆ`selected`ï¼‰ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ãŸã³ã«å¤‰ã‚ã‚‹
2. **è‡ªå‹•ç”Ÿæˆ ID ã®æºã‚Œ**: ãƒãƒ¼ãƒ‰ ID ã‚„ã‚¨ãƒƒã‚¸ ID ãŒã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã§æ¯å›å¤‰ã‚ã‚‹å¯èƒ½æ€§
3. **å‡¦ç†å¤‰æ›´ã®åŸ‹æ²¡**: æœ¬å½“ã«é‡è¦ãªå¤‰æ›´ï¼ˆãƒ¢ãƒ‡ãƒ«è¨­å®šã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹é€ ï¼‰ãŒå¤§é‡ã® diff ã«åŸ‹ã‚‚ã‚Œã‚‹

### èª¿æŸ»å†…å®¹

ä»¥ä¸‹ã‚’ Web ãŠã‚ˆã³ Dify ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€GitHub ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰èª¿æŸ»ã—ã¾ã—ãŸï¼š

- Dify DSL ã®ä»•æ§˜ã¨æ§‹é€ ï¼ˆ[å‚è€ƒ](https://github.com/langgenius/dify/discussions/8090)ï¼‰
- ã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã€Œå‡¦ç†ã«å½±éŸ¿ã™ã‚‹ã‹ã€ã€ŒUI ã®ã¿ã‹ã€ã®åˆ†é¡
- YAML å·®åˆ†ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ãƒ„ãƒ¼ãƒ«ï¼ˆ[dyff](https://github.com/homeport/dyff), [yaml-diff](https://github.com/sters/yaml-diff)ï¼‰
- CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿æ–¹æ³•

---

## ğŸ“Š å®Ÿéš›ã®å·®åˆ†ã‚’è¦‹ã¦ã¿ã‚‹

å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ `chat.yml` ã«åŠ ãˆãŸå¤‰æ›´ã‚’åˆ†æã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### âŒ ç„¡è¦–ã™ã¹ãå·®åˆ†ï¼ˆUIãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»156è¡Œä¸­ ç´„80%ï¼‰

```diff
# ãƒãƒ¼ãƒ‰åº§æ¨™ã®å¤‰æ›´ï¼ˆcanvasä¸Šã§ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸã ã‘ï¼‰
- position: {x: 379, y: 282}
+ position: {x: 291, y: 128}

# ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®å¾®èª¿æ•´ï¼ˆè‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- height: 90
+ height: 88
- width: 244
+ width: 242

# UIé¸æŠçŠ¶æ…‹ã®å¤‰åŒ–ï¼ˆã‚¨ãƒ‡ã‚£ã‚¿ã§åˆ¥ã®ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰
- selected: true
+ selected: false

# ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆä½ç½®ã®å¤‰åŒ–ï¼ˆcanvas ã®ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³ï¼‰
- viewport: {x: 0, y: 0, zoom: 1}
+ viewport: {x: -181, y: 120, zoom: 1}
```

**ã“ã‚Œã‚‰ã¯å‡¦ç†ã«å…¨ãå½±éŸ¿ã—ã¾ã›ã‚“ã€‚**

### âœ… æ¤œçŸ¥ã™ã¹ãå·®åˆ†ï¼ˆå‡¦ç†ã«å½±éŸ¿ãƒ»156è¡Œä¸­ ç´„20%ï¼‰

```diff
# æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒƒã‚¸ã®è¿½åŠ ï¼ˆå‡¦ç†ãƒ•ãƒ­ãƒ¼ã®å¤‰æ›´ï¼ï¼‰
+ edges:
+   - id: 1751895512731-source-1765185537128-target
+     source: '1751895512731'
+     target: '1765185537128'

# æ–°ã—ã„LLMãƒãƒ¼ãƒ‰ã®è¿½åŠ ï¼ˆãƒ¢ãƒ‡ãƒ«è¨­å®šã®è¿½åŠ ï¼ï¼‰
+ nodes:
+   - id: '1765185537128'
+     data:
+       model:
+         name: gemini-2.5-pro  # â† é‡è¦ï¼æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«
+       prompt_template:
+         - text: hi  # â† é‡è¦ï¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹
```

**ã“ã‚Œã‚‰ã¯å‡¦ç†ã«å½±éŸ¿ã—ã¾ã™ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆã§ã™ã€‚**

---

## ğŸ§© åˆ†é¡è¡¨ï¼šç„¡è¦–ã™ã¹ã vs æ¤œçŸ¥ã™ã¹ã

èª¿æŸ»ã®çµæœã€ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡ã§ãã¾ã—ãŸã€‚

### ç„¡è¦–å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆUI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ | å½±éŸ¿ç¯„å›² |
|-----------|------|---------|
| `position.x/y` | ãƒãƒ¼ãƒ‰ã® canvas ä¸Šã®åº§æ¨™ | UI ã®ã¿ |
| `positionAbsolute.x/y` | çµ¶å¯¾åº§æ¨™ | UI ã®ã¿ |
| `width` / `height` | ãƒãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚º | UI ã®ã¿ |
| `selected` | ãƒãƒ¼ãƒ‰ã®é¸æŠçŠ¶æ…‹ | UI ã®ã¿ |
| `zIndex` | è¡¨ç¤ºé †åº | UI ã®ã¿ |
| `viewport.x/y/zoom` | canvas ã®è¡¨ç¤ºä½ç½® | UI ã®ã¿ |
| `sourcePosition` / `targetPosition` | ã‚¨ãƒƒã‚¸ã®æ¥ç¶šä½ç½® | UI ã®ã¿ |

### æ¤œçŸ¥ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå‡¦ç†ã«å½±éŸ¿ï¼‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ | å½±éŸ¿ç¯„å›² |
|-----------|------|---------|
| `nodes[].data.model.*` | AI ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆname, providerï¼‰ | **å®Ÿè¡Œçµæœã«ç›´æ¥å½±éŸ¿** |
| `nodes[].data.prompt_template` | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ | **å®Ÿè¡Œçµæœã«ç›´æ¥å½±éŸ¿** |
| `nodes[].data.completion_params` | temperature ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | **å®Ÿè¡Œçµæœã«ç›´æ¥å½±éŸ¿** |
| `edges[]` ã®è¿½åŠ ãƒ»å‰Šé™¤ | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¥ç¶šæ§‹é€  | **å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒå¤‰ã‚ã‚‹** |
| `features.*.enabled` | æ©Ÿèƒ½ã® ON/OFF | **åˆ©ç”¨å¯èƒ½æ©Ÿèƒ½ãŒå¤‰ã‚ã‚‹** |
| `variables` / `environment_variables` | å¤‰æ•°å®šç¾© | **å®Ÿè¡Œæ™‚ã®æŒ™å‹•ãŒå¤‰ã‚ã‚‹** |
| `dependencies[]` | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¾å­˜é–¢ä¿‚ | **åˆ©ç”¨å¯èƒ½æ©Ÿèƒ½ãŒå¤‰ã‚ã‚‹** |

---

## ğŸ› ï¸ 4ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¾¹åº•æ¯”è¼ƒ

èª¿æŸ»çµæœã‚’ã‚‚ã¨ã«ã€4ã¤ã®å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¤œè¨ã—ã¾ã—ãŸã€‚

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° ğŸš€

**æ¦‚è¦**: äº‹å‰å®šç¾©ã—ãŸã€Œç„¡è¦–ãƒªã‚¹ãƒˆã€ã§ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ©Ÿæ¢°çš„ã«é™¤å¤–

```python
DROP_FIELDS = [
    'position', 'positionAbsolute', 'width', 'height',
    'selected', 'zIndex', 'viewport',
    'sourcePosition', 'targetPosition'
]
```

**é•·æ‰€**:
- âš¡ **å®Ÿè¡Œé€Ÿåº¦**: è¶…é«˜é€Ÿï¼ˆ< 1ç§’ï¼‰
- ğŸ’° **ã‚³ã‚¹ãƒˆ**: 0å††ï¼ˆAPI ä¸è¦ï¼‰
- ğŸ” **é€æ˜æ€§**: ãƒ«ãƒ¼ãƒ«ãŒæ˜ç¢ºã§ã€æ±ºå®šè«–çš„
- ğŸ› ï¸ **å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜†â˜†ï¼ˆç°¡å˜ï¼‰

**çŸ­æ‰€**:
- ğŸ”§ **ä¿å®ˆæ€§**: Dify ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã«ãƒ«ãƒ¼ãƒ«æ›´æ–°ãŒå¿…è¦
- ğŸ¤– **æŸ”è»Ÿæ€§**: æ–°ã—ã„ UI ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è‡ªå‹•æ¤œå‡ºã§ããªã„
- ğŸ“ **èª¬æ˜**: ã€Œãªãœé‡è¦ã‹ã€ã®èª¬æ˜ã‚’ç”Ÿæˆã§ããªã„

**å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**:
- äºˆç®—ãŒå³ã—ã„ï¼ˆLLM API ã‚³ã‚¹ãƒˆã‚’é¿ã‘ãŸã„ï¼‰
- é«˜é€Ÿå®Ÿè¡ŒãŒæœ€å„ªå…ˆï¼ˆCI ã§ 1ç§’æœªæº€ï¼‰
- ãƒãƒ¼ãƒ ãŒå…¨å“¡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼ˆå·®åˆ†ã®èª¬æ˜ä¸è¦ï¼‰

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: æ§‹é€ çš„å·®åˆ†è§£æ ğŸ”¬

**æ¦‚è¦**: `deepdiff` ãªã©ã§æ§‹é€ çš„ã«è§£æã—ã€JSONPath ãƒ‘ã‚¿ãƒ¼ãƒ³ã§é‡è¦åº¦ã‚’åˆ¤å®š

```python
from deepdiff import DeepDiff

diff = DeepDiff(old_yaml, new_yaml, ignore_order=True)
important = filter_by_jsonpath(diff, patterns=[
    r'.*\.nodes\[\d+\]\.data\.model',
    r'.*\.nodes\[\d+\]\.data\.prompt_template'
])
```

**é•·æ‰€**:
- ğŸ¯ **ç²¾åº¦**: é…åˆ—è¦ç´ ã®ç§»å‹•ãƒ»è¿½åŠ ãƒ»å‰Šé™¤ã‚’æ­£ç¢ºã«æ¤œå‡º
- ğŸ”§ **æŸ”è»Ÿæ€§**: æ­£è¦è¡¨ç¾ã§æŸ”è»Ÿãªãƒ«ãƒ¼ãƒ«å®šç¾©ãŒå¯èƒ½
- ğŸ› ï¸ **å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜…â˜†ï¼ˆä¸­ç¨‹åº¦ï¼‰

**çŸ­æ‰€**:
- ğŸ“ˆ **è¤‡é›‘ã•**: ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã®è¤‡é›‘ã•ãŒå¢—ã™
- â±ï¸ **é€Ÿåº¦**: å¤§è¦æ¨¡ YAML ã§å‡¦ç†æ™‚é–“ãŒå¢—åŠ 
- ğŸ“ **èª¬æ˜**: èª¬æ˜ç”Ÿæˆã¯ä¸å¯

**å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**:
- è¤‡é›‘ãªãƒã‚¹ãƒˆã‚„é…åˆ—æ“ä½œãŒå¤šã„
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚ˆã‚Šã‚‚æŸ”è»Ÿã«å¯¾å¿œã—ãŸã„
- èª¬æ˜ã¯ä¸è¦ã ãŒã€ç²¾åº¦ã¯ä¸Šã’ãŸã„

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: LLM ã«ã‚ˆã‚‹æ„å‘³è§£æ ğŸ¤–

**æ¦‚è¦**: å·®åˆ†å…¨ä½“ã‚’ LLM ã«æ¸¡ã—ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç†è§£ã—ã¦é‡è¦åº¦ã‚’åˆ¤å®š

```python
prompt = f"""
ä»¥ä¸‹ã® Dify DSL ã®å·®åˆ†ã‚’åˆ†æã—ã€é‡è¦åº¦ã‚’åˆ¤å®šã—ã¦ãã ã•ã„ã€‚

å·®åˆ†:
{diff_text}

å‡ºåŠ›å½¢å¼ï¼ˆJSONï¼‰:
{{
  "impact": "high|medium|low",
  "area": "model|prompt|features|graph",
  "summary": "å¤‰æ›´å†…å®¹ã®è¦ç´„",
  "action": "è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼|ç„¡è¦–å¯"
}}
"""
response = openai.chat.completions.create(model="gpt-4o-mini", ...)
```

**é•·æ‰€**:
- ğŸ§  **æŸ”è»Ÿæ€§**: ãƒ«ãƒ¼ãƒ«ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ä¸è¦
- ğŸ“ **èª¬æ˜**: è‡ªç„¶è¨€èªã§èª¬æ˜ã‚’è‡ªå‹•ç”Ÿæˆ
- ğŸ†• **é©å¿œæ€§**: æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚è‡ªå‹•ã§åˆ¤å®š
- ğŸ› ï¸ **å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜…â˜†ï¼ˆä¸­ç¨‹åº¦ï¼‰

**çŸ­æ‰€**:
- ğŸ’° **ã‚³ã‚¹ãƒˆ**: æœˆé¡ $0.026 ã€œ $0.60ï¼ˆä½¿ç”¨é‡æ¬¡ç¬¬ï¼‰
- â±ï¸ **ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: 2-10ç§’/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- ğŸ² **éæ±ºå®šè«–çš„**: åŒã˜å…¥åŠ›ã§ã‚‚å‡ºåŠ›ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§

**ã‚³ã‚¹ãƒˆè©¦ç®—ï¼ˆæœˆé–“100å›ã® diff ãƒã‚§ãƒƒã‚¯ï¼‰**:
- GPT-4o-mini: ç´„ $0.026/æœˆï¼ˆç´„4å††ï¼‰
- GPT-4o: ç´„ $0.60/æœˆï¼ˆç´„90å††ï¼‰
- Claude 3.5 Haiku: ç´„ $0.10/æœˆï¼ˆç´„15å††ï¼‰

**å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**:
- ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã«éæŠ€è¡“è€…ã‚’å«ã‚€ï¼ˆèª¬æ˜ãŒå¿…è¦ï¼‰
- æœˆé¡æ•°åå††ã®ã‚³ã‚¹ãƒˆã¯è¨±å®¹å¯èƒ½
- ã€Œãªãœé‡è¦ã‹ã€ã®æ–‡è„ˆã‚’æ®‹ã—ãŸã„

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ â­ æ¨å¥¨

**æ¦‚è¦**: **ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1ï¼‰+ LLM è§£æï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3ï¼‰** ã®çµ„ã¿åˆã‚ã›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å…ƒã® diff   â”‚  156è¡Œã®å·®åˆ†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ â”‚  UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–
â”‚  ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° â”‚  â†’ 80% ã®ãƒã‚¤ã‚ºã‚’å‰Šæ¸›
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ 31è¡Œã®å·®åˆ†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLM è§£æ    â”‚  æ®‹ã£ãŸå·®åˆ†ã‚’æ„å‘³è§£æ
â”‚  + èª¬æ˜ç”Ÿæˆ    â”‚  â†’ é‡è¦åº¦åˆ¤å®š + èª¬æ˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. PR ã‚³ãƒ¡ãƒ³ãƒˆ â”‚  ã€ŒLLM2 ãƒãƒ¼ãƒ‰è¿½åŠ ï¼ˆgemini-2.5-proï¼‰
â”‚    è‡ªå‹•æŠ•ç¨¿    â”‚   å½±éŸ¿: é«˜ / è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é•·æ‰€**:
- âš¡ **é€Ÿåº¦**: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§é«˜é€Ÿå‰å‡¦ç†
- ğŸ’° **ã‚³ã‚¹ãƒˆ**: LLM ã¯å°ã•ãªå·®åˆ†ã®ã¿å‡¦ç†ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ•°å‰Šæ¸›ï¼‰
- ğŸ“ **èª¬æ˜**: é‡è¦ãªå·®åˆ†ã®ã¿èª¬æ˜ç”Ÿæˆ
- ğŸ”§ **æ®µéšçš„å°å…¥**: ã¾ãšãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿ã§é‹ç”¨é–‹å§‹å¯èƒ½
- ğŸ› ï¸ **å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜…â˜…ï¼ˆä¸­ã€œé›£ï¼‰

**çŸ­æ‰€**:
- ğŸ§© **è¤‡é›‘ã•**: 2å±¤æ§‹é€ ã§ãƒ‡ãƒãƒƒã‚°ãŒé›£ã—ããªã‚‹
- ğŸ”§ **ä¿å®ˆ**: ãƒ«ãƒ¼ãƒ«ã¨ LLM ã®ä¸¡æ–¹ã‚’ç®¡ç†

**å‘ã„ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹**:
- æœ¬æ ¼çš„ãªé‹ç”¨ã‚’è¦‹æ®ãˆã¦ã„ã‚‹
- ã‚³ã‚¹ãƒˆã¨ç²¾åº¦ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚ŠãŸã„
- æ®µéšçš„ã«å°å…¥ã—ãŸã„

---

## ğŸ“Š æ¯”è¼ƒè¡¨ï¼šã©ã‚Œã‚’é¸ã¶ï¼Ÿ

| é …ç›® | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1<br>ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2<br>æ§‹é€ çš„å·®åˆ† | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3<br>LLM è§£æ | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4<br>ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ |
|-----|-------------|--------------|-------------|-------------|
| **å®Ÿè£…é›£æ˜“åº¦** | â˜…â˜†â˜† ç°¡å˜ | â˜…â˜…â˜† ä¸­ç¨‹åº¦ | â˜…â˜…â˜† ä¸­ç¨‹åº¦ | â˜…â˜…â˜… ä¸­ã€œé›£ |
| **å®Ÿè¡Œé€Ÿåº¦** | â˜…â˜…â˜… è¶…é«˜é€Ÿ<br>< 1ç§’ | â˜…â˜…â˜† é«˜é€Ÿ<br>1-3ç§’ | â˜…â˜†â˜† é…ã„<br>2-10ç§’ | â˜…â˜…â˜† é«˜é€Ÿ<br>1-5ç§’ |
| **ç²¾åº¦** | â˜…â˜…â˜† è‰¯å¥½ | â˜…â˜…â˜† è‰¯å¥½ | â˜…â˜…â˜… å„ªç§€ | â˜…â˜…â˜… å„ªç§€ |
| **ã‚³ã‚¹ãƒˆ** | â˜…â˜…â˜… 0å†† | â˜…â˜…â˜… 0å†† | â˜…â˜…â˜† æœˆé¡4-90å†† | â˜…â˜…â˜† æœˆé¡4-90å†† |
| **ä¿å®ˆæ€§** | â˜…â˜…â˜† è¦æ›´æ–° | â˜…â˜†â˜† è¤‡é›‘ | â˜…â˜…â˜… å®¹æ˜“ | â˜…â˜…â˜† 2å±¤ç®¡ç† |
| **èª¬æ˜ç”Ÿæˆ** | âœ— ä¸å¯ | âœ— ä¸å¯ | â—‹ å¯èƒ½ | â—‹ å¯èƒ½ |
| **å°å…¥ã‚¹ãƒ”ãƒ¼ãƒ‰** | ğŸš€ 1-2é€±é–“ | ğŸ”§ 2-3é€±é–“ | ğŸ¤– 1-2é€±é–“ | âš™ï¸ 3-6é€±é–“ |

---

## ğŸ¯ æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®é¸ã³æ–¹

### ãƒ‘ã‚¿ãƒ¼ãƒ³ A: ã¾ãšã¯ç„¡æ–™ã§è©¦ã—ãŸã„ â†’ **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1**

- åˆæœŸè²»ç”¨: 0å††
- å®Ÿè£…æœŸé–“: 1-2é€±é–“
- å¾Œã‹ã‚‰ LLM è¿½åŠ ã‚‚å¯èƒ½

### ãƒ‘ã‚¿ãƒ¼ãƒ³ B: èª¬æ˜ä»˜ããƒ¬ãƒãƒ¼ãƒˆãŒæ¬²ã—ã„ â†’ **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4**

- åˆæœŸè²»ç”¨: 0å††ï¼ˆLLM API ã¯å¾“é‡èª²é‡‘ï¼‰
- å®Ÿè£…æœŸé–“: 3-6é€±é–“
- æ®µéšçš„å°å…¥ï¼ˆã¾ãšãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ï¼‰

### ãƒ‘ã‚¿ãƒ¼ãƒ³ C: ã¨ã«ã‹ãæœ€é€Ÿã§å‹•ã‹ã—ãŸã„ â†’ **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1**

- å®Ÿè£…æœŸé–“: 1é€±é–“
- Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆ1æœ¬ã§å®Œçµ

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼šã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1ã‚’è©¦ã™

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªã€Œãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### 1. ä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install ruamel.yaml
brew install yq dyff  # macOS ã®å ´åˆ
```

### 2. æ­£è¦åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

`scripts/normalize_dify.py` ã‚’ä½œæˆã—ã¾ã™ï¼ˆè©³ç´°ã¯å¾Œè¿°ï¼‰ã€‚

### 3. ä½¿ã„æ–¹

```bash
# DSL ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
dify export app > chat.yml

# æ­£è¦åŒ–ï¼ˆãƒã‚¤ã‚ºå‰Šæ¸›ï¼‰
python scripts/normalize_dify.py chat.yml chat.norm.yml

# å·®åˆ†ã‚’ç¢ºèª
git diff --no-index chat.prev.norm.yml chat.norm.yml

# ã¾ãŸã¯ dyff ã‚’ä½¿ã†ï¼ˆè¦‹ã‚„ã™ã„ï¼‰
dyff between chat.prev.norm.yml chat.norm.yml
```

### 4. CI/CD ã¸ã®çµ„ã¿è¾¼ã¿

`.github/workflows/dify-diff-check.yml`:

```yaml
name: Dify DSL Diff Check

on:
  pull_request:
    paths:
      - '**.yml'

jobs:
  diff-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: pip install ruamel.yaml

      - name: Normalize current DSL
        run: python scripts/normalize_dify.py chat.yml chat.norm.yml

      - name: Get previous version
        run: git show main:chat.yml > chat.prev.yml

      - name: Normalize previous DSL
        run: python scripts/normalize_dify.py chat.prev.yml chat.prev.norm.yml

      - name: Generate diff
        run: |
          git diff --no-index chat.prev.norm.yml chat.norm.yml > diff.txt || true

      - name: Check if diff exists
        id: check
        run: |
          if [ -s diff.txt ]; then
            echo "has_diff=true" >> $GITHUB_OUTPUT
          fi

      - name: Comment PR
        if: steps.check.outputs.has_diff == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const diff = fs.readFileSync('diff.txt', 'utf8');
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `## Dify DSL ã®å·®åˆ†æ¤œçŸ¥\n\n\`\`\`diff\n${diff}\n\`\`\``
            });
```

---

## ğŸ“ normalize_dify.py ã®å®Ÿè£…ä¾‹

```python
#!/usr/bin/env python3
"""
Dify DSLæ­£è¦åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å»ã—ã€å·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®¹æ˜“ã«ã™ã‚‹
"""

import sys
from pathlib import Path
from ruamel.yaml import YAML

# å‰Šé™¤ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆUI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰
DROP_FIELDS = {
    'position', 'positionAbsolute', 'width', 'height',
    'selected', 'zIndex', 'viewport',
    'sourcePosition', 'targetPosition'
}

# ã‚½ãƒ¼ãƒˆã™ã‚‹é…åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
LIST_SORT_KEYS = {
    'allowed_file_extensions',
    'allowed_file_types',
    'transfer_methods'
}

def normalize_node(node):
    """ãƒãƒ¼ãƒ‰ã‹ã‚‰ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤"""
    if isinstance(node, dict):
        return {
            k: normalize_node(v)
            for k, v in node.items()
            if k not in DROP_FIELDS
        }
    elif isinstance(node, list):
        return [normalize_node(item) for item in node]
    return node

def sort_lists(node, parent_key=None):
    """é †åºã«æ„å‘³ãŒãªã„é…åˆ—ã‚’ã‚½ãƒ¼ãƒˆ"""
    if isinstance(node, dict):
        return {
            k: sort_lists(v, k)
            for k, v in node.items()
        }
    elif isinstance(node, list):
        if parent_key in LIST_SORT_KEYS:
            # æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã®ã¿ã‚½ãƒ¼ãƒˆ
            if all(isinstance(x, str) for x in node):
                return sorted(node)
        return [sort_lists(item, parent_key) for item in node]
    return node

def main():
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <input.yml> <output.yml>")
        sys.exit(1)

    input_path = Path(sys.argv[1])
    output_path = Path(sys.argv[2])

    # YAML èª­ã¿è¾¼ã¿
    yaml = YAML()
    yaml.preserve_quotes = True
    yaml.default_flow_style = False

    with input_path.open('r') as f:
        data = yaml.load(f)

    # æ­£è¦åŒ–å‡¦ç†
    data = normalize_node(data)
    data = sort_lists(data)

    # å‡ºåŠ›ï¼ˆã‚­ãƒ¼ã‚’ã‚½ãƒ¼ãƒˆï¼‰
    yaml.sort_base_mapping_type_on_output = False  # ã‚½ãƒ¼ãƒˆã¯æ‰‹å‹•ã§
    with output_path.open('w') as f:
        yaml.dump(data, f)

    print(f"âœ… Normalized: {input_path} â†’ {output_path}")

if __name__ == '__main__':
    main()
```

---

## ğŸ”® ä»Šå¾Œã®æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

### 1. å®‰å®š ID ã®ç”Ÿæˆ

è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ ID ã‚’ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®å®‰å®š ID ã«ç½®ãæ›ãˆï¼š

```python
import hashlib

def make_stable_node_id(node):
    """ãƒãƒ¼ãƒ‰ã®å†…å®¹ã‹ã‚‰ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆ"""
    content = f"{node['data']['type']}:{node['data'].get('title', '')}"
    return hashlib.sha256(content.encode()).hexdigest()[:12]
```

### 2. LLM çµ±åˆï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4ã¸ã®é€²åŒ–ï¼‰

```python
import openai

def analyze_diff_with_llm(diff_text):
    """LLM ã§å·®åˆ†ã‚’è§£æ"""
    response = openai.chat.completions.create(
        model="gpt-4o-mini",
        messages=[{
            "role": "system",
            "content": "Dify DSL ã®å·®åˆ†ã‚’åˆ†æã—ã€é‡è¦åº¦ã‚’ JSON ã§è¿”ã—ã¦ãã ã•ã„ã€‚"
        }, {
            "role": "user",
            "content": diff_text
        }]
    )
    return response.choices[0].message.content
```

### 3. Slack é€šçŸ¥

```python
import requests

def post_to_slack(webhook_url, message):
    """Slack ã«é€šçŸ¥"""
    requests.post(webhook_url, json={"text": message})
```

---

## âœ… ã¾ã¨ã‚

### èª¿æŸ»ã§åˆ†ã‹ã£ãŸã“ã¨

1. **Dify DSL ã® 80% ã¯ UI ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã§ã€å‡¦ç†ã«å½±éŸ¿ã—ãªã„
2. **ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**ã§å¤§éƒ¨åˆ†ã®ãƒã‚¤ã‚ºã‚’é™¤å»å¯èƒ½
3. **LLM ã‚’çµ„ã¿åˆã‚ã›ã‚‹**ã¨ã€èª¬æ˜ä»˜ããƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã§ãã‚‹
4. **æœˆé¡4å††ã€œ**ã§ LLM ã«ã‚ˆã‚‹æ„å‘³è§£æãŒåˆ©ç”¨å¯èƒ½

### ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é¸ã¶ã¹ãã‹ï¼Ÿ

| ã‚±ãƒ¼ã‚¹ | æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | ç†ç”± |
|--------|--------------|------|
| ã¾ãšã¯è©¦ã—ãŸã„ | **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1** | 0å††ãƒ»1é€±é–“ã§å®Ÿè£…å¯èƒ½ |
| ãƒãƒ¼ãƒ å…¨å“¡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ | **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1** | èª¬æ˜ä¸è¦ã€é«˜é€Ÿ |
| éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ | **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4** | èª¬æ˜ç”ŸæˆãŒå¿…é ˆ |
| æœ¬æ ¼é‹ç”¨ã‚’è¦‹æ®ãˆã‚‹ | **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ4** | æ‹¡å¼µæ€§ãƒ»ç²¾åº¦ãŒé«˜ã„ |

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ä»Šæ—¥ã‹ã‚‰è©¦ã™**: `normalize_dify.py` ã‚’ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
2. **CI ã«çµ„ã¿è¾¼ã‚€**: GitHub Actions ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
3. **å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µ**: LLM çµ±åˆã€Slack é€šçŸ¥ã€å®‰å®š ID ãªã©

---

## ğŸ“š å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Dify ã‚¢ãƒ—ãƒªç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.dify.ai/en/guides/management/app-management)
- [Dify DSL æ–‡æ³•ã«é–¢ã™ã‚‹ Discussion](https://github.com/langgenius/dify/discussions/8090)
- [Dify Workflow ãƒãƒ¼ãƒ‰ API å®Ÿè£…](https://github.com/langgenius/dify/blob/main/api/core/workflow/nodes/base/node.py)

### YAML å·®åˆ†ãƒ„ãƒ¼ãƒ«
- [dyff - YAML diff ãƒ„ãƒ¼ãƒ«](https://github.com/homeport/dyff)
- [yaml-diff - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä»˜ã diff](https://github.com/sters/yaml-diff)
- [yamldiff - æ§‹é€ çš„ YAML æ¯”è¼ƒ](https://github.com/semihbkgr/yamldiff)

### CI/CD ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [Semantic Versioning with CI/CD](https://semaphore.io/blog/semantic-versioning-cicd)
- [GitVersion ã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°](https://andrewilson.co.uk/post/2025/05/cicd-and-automatic-semantic-versioning/)

---

## ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ»è³ªå•

ã“ã®è¨˜äº‹ã®å†…å®¹ã«ã¤ã„ã¦è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Œã°ã€Issue ã‚„ PR ã§ãŠæ°—è»½ã«ã©ã†ãï¼

**Happy Dify Workflow Development! ğŸš€**
